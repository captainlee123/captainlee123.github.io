<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>地图开发文档 | iOS SDK 开发文档</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.5bb52e53.css" as="style"><link rel="preload" href="/assets/js/app.e5381e1c.js" as="script"><link rel="preload" href="/assets/js/2.5c3cad24.js" as="script"><link rel="prefetch" href="/assets/js/10.4267d358.js"><link rel="prefetch" href="/assets/js/11.69c3ec15.js"><link rel="prefetch" href="/assets/js/12.085a974d.js"><link rel="prefetch" href="/assets/js/3.8e8c4ef4.js"><link rel="prefetch" href="/assets/js/4.49fc2ee8.js"><link rel="prefetch" href="/assets/js/5.1757d00f.js"><link rel="prefetch" href="/assets/js/6.854f45bb.js"><link rel="prefetch" href="/assets/js/7.29c2725c.js"><link rel="prefetch" href="/assets/js/8.6d08e58a.js"><link rel="prefetch" href="/assets/js/9.a6ac628f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5bb52e53.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">iOS SDK 开发文档</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dev/map/" class="nav-link router-link-exact-active router-link-active">地图</a></div><div class="nav-item"><a href="/dev/track/" class="nav-link">轨迹</a></div><div class="nav-item"><a href="/dev/analytics/" class="nav-link">谛听</a></div><div class="nav-item"><a href="/dev/tools/" class="nav-link">地图工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">更新日志</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/update/map/" class="nav-link">地图</a></li><li class="dropdown-item"><!----> <a href="/update/track/" class="nav-link">轨迹</a></li><li class="dropdown-item"><!----> <a href="/update/analytics/" class="nav-link">谛听</a></li><li class="dropdown-item"><!----> <a href="/update/tools/" class="nav-link">地图工具</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dev/map/" class="nav-link router-link-exact-active router-link-active">地图</a></div><div class="nav-item"><a href="/dev/track/" class="nav-link">轨迹</a></div><div class="nav-item"><a href="/dev/analytics/" class="nav-link">谛听</a></div><div class="nav-item"><a href="/dev/tools/" class="nav-link">地图工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">更新日志</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/update/map/" class="nav-link">地图</a></li><li class="dropdown-item"><!----> <a href="/update/track/" class="nav-link">轨迹</a></li><li class="dropdown-item"><!----> <a href="/update/analytics/" class="nav-link">谛听</a></li><li class="dropdown-item"><!----> <a href="/update/tools/" class="nav-link">地图工具</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>地图开发文档</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/dev/map/#手动部署" class="sidebar-link">手动部署</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dev/map/#地图展示" class="sidebar-link">地图展示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/map/#显示地图" class="sidebar-link">显示地图</a></li><li class="sidebar-sub-header"><a href="/dev/map/#显示定位" class="sidebar-link">显示定位</a></li></ul></li><li><a href="/dev/map/#与地图交互" class="sidebar-link">与地图交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/map/#控件交互" class="sidebar-link">控件交互</a></li><li class="sidebar-sub-header"><a href="/dev/map/#手势交互" class="sidebar-link">手势交互</a></li><li class="sidebar-sub-header"><a href="/dev/map/#方法交互" class="sidebar-link">方法交互</a></li></ul></li><li><a href="/dev/map/#在地图上绘制" class="sidebar-link">在地图上绘制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/map/#绘制点标记" class="sidebar-link">绘制点标记</a></li></ul></li><li><a href="/dev/map/#定位" class="sidebar-link">定位</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dev/map/#地图计算工具" class="sidebar-link">地图计算工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/map/#坐标转换" class="sidebar-link">坐标转换</a></li><li class="sidebar-sub-header"><a href="/dev/map/#距离、面积计算" class="sidebar-link">距离、面积计算</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="地图开发文档">地图开发文档</h1> <h2 id="手动部署">手动部署</h2> <ul><li><p>导入SDK</p> <p>1.将HYSDK文件导入工程</p> <p>2.点击target-&gt;选择General-&gt;选择Embedded Binaries-&gt;点击+-&gt;点击Mapbox.framework-&gt;Add</p> <img src="/assets/img/HYMapSDk-em.e6fd2d34.png" width="400" hegiht="200" align="center"> <p>3.点击target-&gt;选择General-&gt;选择linked Frameworks and Libraries-&gt;点击+ -&gt;选择libstdc++.tbd-&gt;Add</p> <img src="/assets/img/HYMapSDK-listdc++.32315937.png" width="400" hegiht="200" align="center"> <p>4.在TARGETS-&gt;Build Settings-&gt;Other Linker Flags 中添加-ObjC，字母 O 和 C 大写。</p> <p>5.使用cocoaPods导入三方库
pod 'AFNetworking', '~&gt; 3.0'
pod 'SDWebImage/GIF'
pod 'YYKit'
pod 'SDWebImage', '~&gt; 4.0.0'
pod 'HYCommonTool'
pod 'FMDB'</p> <p>6.申请权限
定位权限：在项目的 Info.plist 添加定位权限申请，根据您的业务需求，选择下列方式设置。</p> <img src="/assets/img/ios_location_sdk_permission.aad81a57.png" width="300" hegiht="667" align="center"> <ul><li>NSLocationWhenInUseUsageDescription 表示应用在前台的时候可以搜到更新的位置信息。</li></ul></li> <li><p>NSLocationAlwaysUsageDescription 申请Always权限，以便应用在前台和后台（suspend 或 terminated）都可以获取到更新的位置数据。</p></li> <li><p>NSLocationAlwaysAndWhenInUseUsageDescription 申请Always权限，以便应用在前台和后台（suspend 或 terminated）都可以获取到更新的位置数据（NSLocationWhenInUseUsageDescription 也必须有）。</p></li></ul> <p>注意：如果需要同时支持在iOS8-iOS10和iOS11系统上后台定位，建议在plist文件中同时添加NSLocationWhenInUseUsageDescription、NSLocationAlwaysUsageDescription和NSLocationAlwaysAndWhenInUseUsageDescription权限申请。</p> <p>ATS设置</p> <img src="/assets/img/ios_location_sdk_ats.b5c824c6.png" width="300" hegiht="667" align="center"> <h2 id="地图展示">地图展示</h2> <h3 id="显示地图">显示地图</h3> <ul><li>在您的ViewController.h中添加头文件</li></ul> <blockquote><p>#import &quot;HYMapSDK.h&quot;</p></blockquote> <ul><li>实例化地图对象
在ViewController.m文件中添加实例化HYMapView的代码</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">/// 初始化HYMapView对象</span>
HYMapView <span class="token operator">*</span>mapView <span class="token operator">=</span> <span class="token punctuation">[</span>HYMapView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/// 将地图添加至View</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>containerView addSubview<span class="token punctuation">:</span>mapView<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>添加底图</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">/// 底图实例</span>
NSString <span class="token operator">*</span>url <span class="token operator">=</span> <span class="token string">@&quot;http://t0.tianditu.cn/vec_c/wmts?SERVICE=WMTS&amp;REQUEST=GetTile&amp;VERSION=1.0.0&amp;LAYER=vec&amp;STYLE=default&amp;TILEMATRIXSET=c&amp;TILEMATRIX={z}&amp;TILEROW={y}&amp;TILECOL={x}&amp;FORMAT=tiles&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/// 创建HYRasterLayer实例 （layerInfo 可设置最大最小层级等相关属性详见SDK）</span>
HYRasterLayer <span class="token operator">*</span>layer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYRasterLayer alloc<span class="token punctuation">]</span> initWithUrlTemplate<span class="token punctuation">:</span>url layerInfo<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/// 添加底图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addMapLayer<span class="token punctuation">:</span>layer<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>编译，运行工程 效果如图</p> <img src="/assets/img/HYMapVIew-basic.22d7fc19.png" width="300" hegiht="667" align="center"></li> <li><p>加载MapServer图层</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>HYDynamicMapServerLayer <span class="token operator">*</span>layer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYDynamicMapServerLayer alloc<span class="token punctuation">]</span> initWithURL<span class="token punctuation">:</span><span class="token punctuation">[</span>NSURL URLWithString<span class="token punctuation">:</span><span class="token string">@&quot;http:58.213.23.213:6080/arcgis/rest/services/tdlyxzt2016/MapServer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
layer<span class="token punctuation">.</span>layername <span class="token operator">=</span> <span class="token string">@&quot;dynamic_layer&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addMapLayer<span class="token punctuation">:</span>layer<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>加载矢量图层</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>NSString <span class="token operator">*</span>path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSBundle mainBundle<span class="token punctuation">]</span> pathForResource<span class="token punctuation">:</span><span class="token string">@&quot;geoserver_vector_style_3&quot;</span> ofType<span class="token punctuation">:</span><span class="token string">@&quot;json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
NSURL <span class="token operator">*</span>url <span class="token operator">=</span> <span class="token punctuation">[</span>NSURL fileURLWithPath<span class="token punctuation">:</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>

HYVectorLayer <span class="token operator">*</span>layer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYVectorLayer alloc<span class="token punctuation">]</span> initWithURL<span class="token punctuation">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addMapLayer<span class="token punctuation">:</span>layer<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>加载MBTiles</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>HYLayerInfo <span class="token operator">*</span>info <span class="token operator">=</span> <span class="token punctuation">[</span>HYLayerInfo commonInfo<span class="token punctuation">]</span><span class="token punctuation">;</span>
HYMBtilesTileLayer <span class="token operator">*</span>tileLayer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYMBtilesTileLayer alloc<span class="token punctuation">]</span> initWithMBTileFilePath<span class="token punctuation">:</span>url layerInfo<span class="token punctuation">:</span>info<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addMapLayer<span class="token punctuation">:</span>tileLayer<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>加载3D视图</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// geojson</span>
NSString <span class="token operator">*</span>path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSBundle mainBundle<span class="token punctuation">]</span> pathForResource<span class="token punctuation">:</span><span class="token string">@&quot;buildings&quot;</span> ofType<span class="token punctuation">:</span><span class="token string">@&quot;json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
NSData <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token punctuation">[</span>NSData dataWithContentsOfFile<span class="token punctuation">:</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//加载3DLayer</span>
HYFillExtrusionLayer <span class="token operator">*</span>layer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYFillExtrusionLayer alloc<span class="token punctuation">]</span> initWithData<span class="token punctuation">:</span>data encoding<span class="token punctuation">:</span>NSUTF8StringEncoding<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 设置相关属性</span>
layer<span class="token punctuation">.</span>heightExpression <span class="token operator">=</span> <span class="token punctuation">[</span>NSExpression expressionForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;ROOFELEV&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
layer<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span>
layer<span class="token punctuation">.</span>fillColor <span class="token operator">=</span> <span class="token function">RGBA</span><span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加至地图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addMapLayer<span class="token punctuation">:</span>layer<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="显示定位">显示定位</h3> <ul><li><p>显示定位蓝点</p> <p>定位蓝点指的是进入地图后显示用户当前位置点的功能，效果如下：</p> <img src="/assets/img/HYMapVIew-userlocation.4fb4404c.png" width="300" hegiht="667" align="center"></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">///如果您需要进入地图就显示定位小蓝点，则需要下面一行代码</span>
_mapView<span class="token punctuation">.</span><span class="token punctuation">.</span>showsUserLocation <span class="token operator">=</span> YES<span class="token punctuation">;</span>

</code></pre></div><ul><li>自定义定位点</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">/// 设置显示定位点</span>
_mapView<span class="token punctuation">.</span>showsUserLocation <span class="token operator">=</span> YES<span class="token punctuation">;</span>

<span class="token comment">/// 设置代理</span>
_mapView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>

<span class="token comment">/// 实现代理方法 （MGLUserLocation：用户位置信息）</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>HYUserLocationAnnotationView <span class="token operator">*</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView viewForAnnotation<span class="token punctuation">:</span><span class="token punctuation">(</span>MGLUserLocation <span class="token operator">*</span><span class="token punctuation">)</span>annotation <span class="token punctuation">{</span>

HYUserLocationAnnotationView <span class="token operator">*</span>annotationView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYUserLocationAnnotationView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
annotationView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor orangeColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
annotationView<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">30.f</span><span class="token punctuation">;</span>
annotationView<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>masksToBounds <span class="token operator">=</span> YES<span class="token punctuation">;</span>
<span class="token keyword">return</span> annotationView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    注： 自定义定位点必须设置 _mapView<span class="token punctuation">.</span>showsUserLocation <span class="token operator">=</span> YES<span class="token punctuation">;</span> 否则无效

</code></pre></div><h2 id="与地图交互">与地图交互</h2> <h3 id="控件交互">控件交互</h3> <ul><li><p>指南针控件</p> <p>指南针默认是开启状态，显示在地图的右上角。可以通过 HYMapView 的 showsCompass 属性用来控制指南针的可见性。</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 设置成NO表示关闭指南针；YES表示显示指南针</span>
_mapView<span class="token punctuation">.</span>showsCompass<span class="token operator">=</span> YES<span class="token punctuation">;</span>

<span class="token comment">//设置指南针位置</span>
_mapView<span class="token punctuation">.</span>compassView<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>比例尺控件
在HYMapSDK中，比例尺默认显示在地图的左上角。HYMapView 的 showsScale 属性用来控制比例尺的可见性</li></ul> <div class="language- extra-class"><pre class="language-text"><code>//设置成NO表示不显示比例尺；YES表示显示比例尺
_mapView.showsScale = YES;

//设置比例尺位置
_mapView.scaleBar.frame = CGRectMake(0, 0, 60, 60);
</code></pre></div><h3 id="手势交互">手势交互</h3> <ul><li><p>缩放手势</p> <p>缩放手势可改变地图的缩放级别，地图响应的手势分为双击地图可以使缩放级别增加1 (放大)和两个手指捏/拉伸；通过设置zoomEnable属性可以禁用或启用缩放手势。</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">/// NO 表示禁用缩放手势，YES表示开启</span>
_mapView<span class="token punctuation">.</span>zoomEnabled <span class="token operator">=</span> NO<span class="token punctuation">;</span>
</code></pre></div><p>调用 HYMapView的setZoomLevel 方法设置地图的缩放级别，用来缩放地图。</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 设置地图缩放级别</span>
<span class="token punctuation">[</span>_mapView setZoomLevel<span class="token punctuation">:</span><span class="token number">13</span> animated<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>滑动手势</p> <p>您可以用手指拖动地图四处滚动（平移）或用手指滑动地图（动画效果）。</p> <p>通过 HYMapView 的 scrollEnabled 属性可以禁用或开启平移（滑动）手势。</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//NO表示禁用滑动手势，YES表示开启</span>
_mapView<span class="token punctuation">.</span>scrollEnabled <span class="token operator">=</span> NO<span class="token punctuation">;</span>
</code></pre></div><ul><li><p>地图旋转</p> <p>通过 HYMapView 的 rotateEnabled 属性可以禁用或开启地图旋转。</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//NO表示禁用滑动手势，YES表示开启</span>
_mapView<span class="token punctuation">.</span>rotateEnabled <span class="token operator">=</span> NO<span class="token punctuation">;</span>
</code></pre></div><p>还可以动态改变地图方向</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 地图方向 0~359.9</span>
CLLocationDirection direction <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView setDirection<span class="token punctuation">:</span> direction animated<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="方法交互">方法交互</h3> <ul><li>查询范围内的图形</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//获取指定点范围内的图形 (查询所有图层传nil 否则传图层标识identifier)</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>HYShape <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>visibleFeaturesAtPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>CGPoint<span class="token punctuation">)</span>point inMapLayersWithIdentifiers<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable NSArray<span class="token operator">&lt;</span>NSString <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>mapLayerIdentifiers<span class="token punctuation">;</span>

<span class="token comment">//获取指定矩形范围内的图形 (查询所有图层传nil 否则传图层标识identifier)</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>HYShape <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>visibleFeaturesInRect<span class="token punctuation">:</span><span class="token punctuation">(</span>CGRect<span class="token punctuation">)</span>rect inMapLayersWithIdentifiers<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable NSArray<span class="token operator">&lt;</span>NSString <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>mapLayerIdentifiers<span class="token punctuation">;</span>

</code></pre></div><ul><li>改变地图的缩放级别</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 设置地图缩放级别</span>
<span class="token punctuation">[</span>_mapView setZoomLevel<span class="token punctuation">:</span><span class="token number">13</span> animated<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 放大层级</span>
<span class="token punctuation">[</span>_mapView zoomIn<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 缩小层级</span>
<span class="token punctuation">[</span>_mapView zoomOut<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><ul><li><p>改变地图的中心点</p> <p>地图平移时，缩放级别不变，可通过改变地图的中心点来移动地图，示例代码如下：</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token punctuation">[</span>_mapView setCenterCoordinate<span class="token punctuation">:</span>center animated<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>屏幕地图坐标点转换</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//屏幕坐标转底图坐标</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>screenPointToMapPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>CGPoint<span class="token punctuation">)</span>screenPoint<span class="token punctuation">;</span>

<span class="token comment">//底图坐标转屏幕坐标</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>CGPoint<span class="token punctuation">)</span>mapPointToScreenPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>mapPoint<span class="token punctuation">;</span>
</code></pre></div><ul><li>限制地图显示范围</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 地图显示范围</span>
HYCoordinateBounds bounds <span class="token operator">=</span> <span class="token function">HYCoordinateBoundsMake</span><span class="token punctuation">(</span><span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置地图显示范围</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView setVisibleCoordinateBounds<span class="token punctuation">:</span>bounds edgePadding<span class="token punctuation">:</span><span class="token function">UIEdgeInsetsMake</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><ul><li><p>事件交互</p> <p>所有事件交互都会由HYMapViewDelegate回调， 需提前设置HYMapView的delegate</p> <p>地图状态改变</p></li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">/// 地图显示范围发生变化 层级（zoomLevel）、角度（ratotion）、位置（position）发生变化时，都会调用该方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapViewRegionIsChanging<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapViewRegionDidChange<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView<span class="token punctuation">;</span>

</code></pre></div><p>单击地图</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 点击地图时回调</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView didClickAtPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>CGPoint<span class="token punctuation">)</span>screenPoint mapPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>mapPoint<span class="token punctuation">;</span>
</code></pre></div><p>长按地图</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 长按地图时回调</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView didTapAndHoldAtPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>CGPoint<span class="token punctuation">)</span>screenPoint mapPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>mapPoint<span class="token punctuation">;</span>
</code></pre></div><p>双击地图</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 双击事件 (地图属性zoomEnable = NO 时有效)</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView doubleTapAtPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>CGPoint<span class="token punctuation">)</span>screenPoint mapPoint<span class="token punctuation">:</span><span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>mapPoint<span class="token punctuation">;</span>

</code></pre></div><p>定位图标点击</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>  <span class="token comment">///点击定位图标</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView didSelectUserLocationAnnotation<span class="token punctuation">:</span><span class="token punctuation">(</span>MGLUserLocation <span class="token operator">*</span><span class="token punctuation">)</span>annotation<span class="token punctuation">;</span>

</code></pre></div><h2 id="在地图上绘制">在地图上绘制</h2> <h3 id="绘制点标记">绘制点标记</h3> <p>标注可以精确表示用户需要展示的位置信息，HYMapSDK提供的标注功能允许用户自定义图标和信息窗</p> <ul><li>添加点标记</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 实例化点注记</span>
HYPoint <span class="token operator">*</span>point <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYPoint alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 设置点坐标</span>
point<span class="token punctuation">.</span>coordinate <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加点注记属性</span>
point<span class="token punctuation">.</span>attributes <span class="token operator">=</span> dict<span class="token punctuation">;</span>

<span class="token comment">// 设置点注记图标</span>
point<span class="token punctuation">.</span>icon <span class="token operator">=</span> <span class="token punctuation">[</span>UIImage imageNamed<span class="token punctuation">:</span>dict<span class="token punctuation">[</span><span class="token string">@&quot;imagename&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 点注记添加至地图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addPoint<span class="token punctuation">:</span>point<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 添加多个点注记至地图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addPoints<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">[</span>point<span class="token punctuation">,</span> point<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>绘制线</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//线</span>
CLLocationCoordinate2D coords<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.034</span><span class="token punctuation">,</span> <span class="token number">118.777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.054</span><span class="token punctuation">,</span> <span class="token number">118.787</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.054</span><span class="token punctuation">,</span> <span class="token number">118.757</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实例化HYPolyline</span>
HYPolyline <span class="token operator">*</span>polyline <span class="token operator">=</span> <span class="token punctuation">[</span>HYPolyline polylineWithCoordinates<span class="token punctuation">:</span>coords count<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 为线添加属性</span>
polyline<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">{</span><span class="token string">@&quot;lineColor&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>UIColor orangeColor<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置线宽</span>
polyline<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5.0f</span><span class="token punctuation">;</span>

<span class="token comment">// 设置线颜色</span>
polyline<span class="token punctuation">.</span>lineColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor orangeColor<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 添加线至地图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addPolyline<span class="token punctuation">:</span> polyline<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 多线</span>
HYMultiPolyline <span class="token operator">*</span>multiPolyline <span class="token operator">=</span> <span class="token punctuation">[</span>HYMultiPolyline multiPolylineWithPolylines<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">[</span>polyline<span class="token punctuation">,</span> polyline<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 为线添加属性</span>
multiPolyline<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">{</span><span class="token string">@&quot;lineColor&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>UIColor orangeColor<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置线宽</span>
multiPolyline<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5.0f</span><span class="token punctuation">;</span>

<span class="token comment">// 设置线颜色</span>
multiPolyline<span class="token punctuation">.</span>lineColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor orangeColor<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 添加多线至地图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addMultiPolyline<span class="token punctuation">:</span>multiPolyline<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>绘制面</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>CLLocationCoordinate2D coords<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.034</span><span class="token punctuation">,</span> <span class="token number">118.777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.054</span><span class="token punctuation">,</span> <span class="token number">118.787</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.054</span><span class="token punctuation">,</span> <span class="token number">118.757</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.034</span><span class="token punctuation">,</span> <span class="token number">118.777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 生成面对象</span>
HYPolygon <span class="token operator">*</span>polygon <span class="token operator">=</span> <span class="token punctuation">[</span>HYPolygon polygonWithCoordinates<span class="token punctuation">:</span>coords1 count<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 设置面的颜色</span>
polygon1<span class="token punctuation">.</span>fillColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor greenColor<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 设置面的透明度</span>
polygon1<span class="token punctuation">.</span>fillOpacity <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>

<span class="token comment">// 添加至地图</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView addPolygon<span class="token punctuation">:</span>polygon<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>注记气泡</li></ul> <p>如果需要展示气泡 需要实现HYMapView的代理并回调方法</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 设置代理</span>
_mapView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>

<span class="token comment">// 回调为YES时 气泡才会展示</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView annotationCanShowCallout<span class="token punctuation">:</span><span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>annotation <span class="token punctuation">{</span>
    <span class="token keyword">return</span> YES<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当选中注记时如果需要Callout</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>HYPoint <span class="token operator">*</span>point <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>HYPoint alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 设置点坐标</span>
point<span class="token punctuation">.</span>coordinate <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在点击的注记上展示弹框</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mapView showCalloutToMapViewWithPoint<span class="token punctuation">:</span>pointFeature title<span class="token punctuation">:</span><span class="token string">@&quot;当前位置&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>自定义CalloutView</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 自定义CalloutView 需实现MGLCalloutView协议</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span>MGLCalloutView<span class="token operator">&gt;</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView calloutViewForAnnotation<span class="token punctuation">:</span><span class="token punctuation">(</span>HYPoint <span class="token operator">*</span><span class="token punctuation">)</span>annotation <span class="token punctuation">{</span>
    CustomeMapViewCalloutView <span class="token operator">*</span>calloutView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>CustomeMapViewCalloutView alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> calloutView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="定位">定位</h2> <ul><li>使用HYMapView自带定位</li></ul> <p>HYMapView 自带有定位功， 如果设置了showsUserLocation属性为YES可直接使用</p> <p>可通过HYMapView的userLocation属性获取用户定位数据详情 或者 通过回调接口即时获取用户定位属性</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//位置更新（showsUserLocation 设置为YES时有效）</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView didUpdateUserLocation<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable MGLUserLocation <span class="token operator">*</span><span class="token punctuation">)</span>userLocation<span class="token punctuation">;</span>

<span class="token comment">//设置showsUserLocation为YES 定位失败时回调</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapView<span class="token punctuation">:</span><span class="token punctuation">(</span>HYMapView <span class="token operator">*</span><span class="token punctuation">)</span>mapView didFailToLocateUserWithError<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error <span class="token punctuation">;</span>
</code></pre></div><ul><li>HYLocationKit</li></ul> <p>如果showsUserLocation设置为NO HYMapSDK提供了HYLocationKit来获取定位信息</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">// 开启定位</span>
<span class="token punctuation">[</span>HYLocationManager shareInstance<span class="token punctuation">]</span> startLocationCompletion<span class="token punctuation">:</span><span class="token punctuation">(</span>HYLocationObj <span class="token operator">*</span>locationObj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 信号强度</span>
    location<span class="token punctuation">.</span>strenth
    <span class="token comment">///administrativeArea-省级名称  locality-市级名称</span>
    location<span class="token punctuation">.</span>placemark
    <span class="token comment">///坐标点</span>
    location<span class="token punctuation">.</span>latitude
    location<span class="token punctuation">.</span>lonetitude
    <span class="token comment">// 定位错误信息</span>
    location<span class="token punctuation">.</span>error
<span class="token punctuation">}</span>
</code></pre></div><h2 id="地图计算工具">地图计算工具</h2> <h3 id="坐标转换">坐标转换</h3> <p>HYMapSDK中的EvilTransform.h中提供了坐标转换方法，具体的接口可参考：EvilTransform.h 。</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//经纬度转墨卡托</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>lonLat2Mercator<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>coordinate <span class="token punctuation">;</span>

<span class="token comment">//墨卡托转经纬度</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>mercator2lonLat<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>merctor <span class="token punctuation">;</span>

<span class="token comment">//百度（BD_09）转 WGS84</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>bd09ToWgs84<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>location<span class="token punctuation">;</span>

<span class="token comment">//百度（BD-09）转GCJ02</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>bd09ToGcj02<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>location<span class="token punctuation">;</span>

<span class="token comment">//GCJ02转百度（BD-09）</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>gcj02ToBd09<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>location<span class="token punctuation">;</span>

<span class="token comment">//WGS84转百度（BD-09）</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>wgs84ToBd09<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>location<span class="token punctuation">;</span>

<span class="token comment">//GCJ02转WGS84</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>gcj02ToWgs84<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D<span class="token punctuation">)</span>location<span class="token punctuation">;</span>

</code></pre></div><h3 id="距离、面积计算">距离、面积计算</h3> <p>距离、面积计算使用HYMapGeometry.h类</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">//计算线长度</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>calculateDistance<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D <span class="token operator">*</span><span class="token punctuation">)</span>latLngs count<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>count<span class="token punctuation">;</span>

<span class="token comment">//计算面积</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>calculateArea<span class="token punctuation">:</span><span class="token punctuation">(</span>CLLocationCoordinate2D <span class="token operator">*</span><span class="token punctuation">)</span>coors count<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>count<span class="token punctuation">;</span>

</code></pre></div><p>判断点是否在范围内</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>CLLocationCoordinate2D location
<span class="token function">HYCoordinateInCoordinateBounds</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> coordinateBounds<span class="token punctuation">)</span>
</code></pre></div><p>计算路径缓冲</p> <p>路径缓冲计算需要使用GeosUntils.h类，并需要导入libgeos.a文件</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token comment">/// coordinates:路径坐标串（需要转为墨卡托坐标系）</span>
<span class="token comment">/// distance:缓冲半径</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>NSArray <span class="token operator">&lt;</span>GeosCoordinate <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>bufferGeometry<span class="token punctuation">:</span><span class="token punctuation">(</span>NSArray <span class="token operator">&lt;</span>GeosCoordinate <span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">*</span><span class="token punctuation">)</span>coordinates byDistance<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>distance <span class="token punctuation">;</span>

<span class="token comment">// 坐标串</span>
CLLocationCoordinate2D coords<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.034</span><span class="token punctuation">,</span> <span class="token number">118.777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.054</span><span class="token punctuation">,</span> <span class="token number">118.777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.054</span><span class="token punctuation">,</span> <span class="token number">118.757</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coords<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CLLocationCoordinate2DMake</span><span class="token punctuation">(</span><span class="token number">32.034</span><span class="token punctuation">,</span> <span class="token number">118.777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 转为墨卡托坐标系</span>
CLLocationCoordinate2D coor1 <span class="token operator">=</span> <span class="token punctuation">[</span>EvilTransform lonLat2Mercator<span class="token punctuation">:</span>coords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
CLLocationCoordinate2D coor2 <span class="token operator">=</span> <span class="token punctuation">[</span>EvilTransform lonLat2Mercator<span class="token punctuation">:</span>coords<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
CLLocationCoordinate2D coor3 <span class="token operator">=</span> <span class="token punctuation">[</span>EvilTransform lonLat2Mercator<span class="token punctuation">:</span>coords<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
CLLocationCoordinate2D coor4 <span class="token operator">=</span> <span class="token punctuation">[</span>EvilTransform lonLat2Mercator<span class="token punctuation">:</span>coords<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// GeosCoordinate *coordinate1 = [[GeosCoordinate alloc] initWithLatitude:coor1.latitude longitude:coor1.longitude];</span>
GeosCoordinate <span class="token operator">*</span>coordinate2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>GeosCoordinate alloc<span class="token punctuation">]</span> initWithLatitude<span class="token punctuation">:</span>coor2<span class="token punctuation">.</span>latitude longitude<span class="token punctuation">:</span>coor2<span class="token punctuation">.</span>longitude<span class="token punctuation">]</span><span class="token punctuation">;</span>
GeosCoordinate <span class="token operator">*</span>coordinate3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>GeosCoordinate alloc<span class="token punctuation">]</span> initWithLatitude<span class="token punctuation">:</span>coor3<span class="token punctuation">.</span>latitude longitude<span class="token punctuation">:</span>coor3<span class="token punctuation">.</span>longitude<span class="token punctuation">]</span><span class="token punctuation">;</span>
GeosCoordinate <span class="token operator">*</span>coordinate4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>GeosCoordinate alloc<span class="token punctuation">]</span> initWithLatitude<span class="token punctuation">:</span>coor4<span class="token punctuation">.</span>latitude longitude<span class="token punctuation">:</span>coor4<span class="token punctuation">.</span>longitude<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 计算缓冲路径</span>
NSArray <span class="token operator">*</span>resultBuffer <span class="token operator">=</span> <span class="token punctuation">[</span>GeosUntils bufferGeometry<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">[</span>coordinate1<span class="token punctuation">,</span>coordinate2<span class="token punctuation">,</span>coordinate3<span class="token punctuation">,</span>coordinate4<span class="token punctuation">]</span> byDistance<span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><img src="/assets/img/HYMapSDK-buffer.a5c5e49c.png" width="260" hegiht="100" align="center"></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.e5381e1c.js" defer></script><script src="/assets/js/2.5c3cad24.js" defer></script>
  </body>
</html>
